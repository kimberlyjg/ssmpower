---
title: "Introduction to ssmpower"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to ssmpower}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
```

## Overview

The `ssmpower` package provides tools for **power analysis and sample size planning** 
for Structural Summary Method (SSM) analyses of circumplex data. The methods are 
based on:
                                 
- Zimmermann & Wright (2017) - Bootstrap CIs and effect size benchmarks
- Gurtman (1992) - Foundational SSM methodology  
- Cohen (1988, 1992) - Power analysis framework

## Installation

```{r install, eval = FALSE}
# Install from GitHub
remotes::install_github("yourusername/ssmpower")
```

```{r load}
library(ssmpower)
```

## Quick Start

```{r quickstart}
# How much power do I have?
ssm_power_amplitude(effect = 0.15, n = 100)

# How many participants do I need?
ssm_sample_size_amplitude(effect = 0.15, power = 0.80)

# Quick reference guide
ssm_sample_size_guide()
```

## Effect Size Benchmarks

From Zimmermann & Wright (2017), based on 433 published SSM analyses:

| Parameter | Small (25th %ile) | Medium (50th %ile) | Large (75th %ile) |
|-----------|-------------------|--------------------|--------------------|
| Amplitude | 0.10              | 0.16               | 0.23               |
| Elevation | 0.02              | 0.11               | 0.27               |

## Power Calculation

### Single-Sample Tests

Test whether amplitude or elevation differs from zero:

```{r power-single}
# Power for medium amplitude effect with n = 100
ssm_power_amplitude(effect = 0.16, n = 100)

# Power for medium elevation effect with n = 200
ssm_power_elevation(effect = 0.11, n = 200)
```

### Two-Group Comparisons

Test whether amplitude or elevation differs between groups:

```{r power-two}
# Power to detect medium amplitude difference, 100 per group
ssm_power_amplitude_diff(effect = 0.16, n1 = 100, n2 = 100)

# Unbalanced design
ssm_power_amplitude_diff(effect = 0.16, n1 = 150, n2 = 75)
```

## Sample Size Calculation

### Single-Sample Tests

```{r ss-single}
# Sample size for 80% power to detect medium amplitude
ssm_sample_size_amplitude(effect = 0.16, power = 0.80)

# Sample size for 90% power to detect small elevation
ssm_sample_size_elevation(effect = 0.02, power = 0.90)
```

### Two-Group Comparisons

```{r ss-two}
# Per-group sample size for medium amplitude difference
ssm_sample_size_amplitude_diff(effect = 0.16, power = 0.80)

# Unbalanced allocation (2:1 ratio)
ssm_sample_size_amplitude_diff(effect = 0.16, power = 0.80, ratio = 2)
```

## Power Tables

Generate tables for study planning:

```{r power-table}
ssm_power_table(
  effects = c(0.10, 0.15, 0.20, 0.25),
  ns = c(50, 100, 150, 200, 300),
  type = "amplitude"
)
```

## Power Curves

Visualize how power changes with sample size:

```{r power-curve, message = FALSE}
library(ggplot2)

# Generate data for multiple effect sizes
ns <- seq(20, 300, by = 5)
effects <- c(0.10, 0.15, 0.20, 0.25)

power_data <- expand.grid(n = ns, effect = effects)
power_data$power <- mapply(function(n, eff) {
  ssm_power_amplitude(eff, n)$power
}, power_data$n, power_data$effect)

# Plot
ggplot(power_data, aes(x = n, y = power, color = factor(effect))) +
  geom_line(linewidth = 1) +
  geom_hline(yintercept = 0.80, linetype = "dashed", color = "gray50") +
  scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
  scale_color_brewer(palette = "Set1", name = "Amplitude") +
  labs(
    title = "Power Curves for SSM Amplitude Tests",
    subtitle = "One-sided test, α = .05",
    x = "Sample Size (N)",
    y = "Statistical Power"
  ) +
  theme_minimal(base_size = 12)
```

## Comprehensive Analysis

For real data, use `ssm_analyze()` to get parameter estimates, bootstrap CIs, 
and post-hoc power:

```{r analyze}
# Simulate example data
set.seed(42)
n <- 250

# External variable (e.g., personality dysfunction)
lpfs <- rnorm(n, mean = 0, sd = 1)

# Simulate octant scores with circumplex structure
angles <- seq(0, 315, by = 45)
angles_rad <- angles * pi / 180

octants <- matrix(NA, nrow = n, ncol = 8)
for (i in 1:8) {
  octants[, i] <- rnorm(n, mean = 3, sd = 1) +
    0.4 * lpfs +                           # Elevation effect
    0.2 * lpfs * cos(angles_rad[i] - pi/2) # Amplitude effect at 90°
}

# Run analysis
result <- ssm_analyze(lpfs, octants, n_boot = 1000, seed = 123)
print(result)
```

## Formulas

### SSM Parameters (Gurtman, 1992)

For correlations $r_1, r_2, \ldots, r_8$ with octants at angles $\theta_1, \theta_2, \ldots, \theta_8$:

$$X = \frac{2}{m} \sum_{i=1}^{m} r_i \cos(\theta_i)$$

$$Y = \frac{2}{m} \sum_{i=1}^{m} r_i \sin(\theta_i)$$

$$\text{Amplitude} = \sqrt{X^2 + Y^2}$$

$$\text{Displacement} = \arctan(Y/X)$$

$$\text{Elevation} = \frac{1}{m} \sum_{i=1}^{m} r_i$$

### Power Functions

For testing $H_0: a = 0$ vs $H_1: a > 0$:

$$\text{Power} = \Phi\left(\frac{a \sqrt{n}}{k} - z_{1-\alpha}\right)$$

For sample size calculation:

$$n = \left[\frac{k(z_{1-\alpha} + z_{1-\beta})}{a}\right]^2$$

Where:

- $a$ = expected amplitude (or elevation)
- $n$ = sample size
- $k$ = scaling constant (0.41 for amplitude, 0.60 for elevation)
- $\alpha$ = significance level
- $\Phi$ = standard normal CDF

## References

Cohen, J. (1988). *Statistical power analysis for the behavioral sciences* (2nd ed.). 
Lawrence Erlbaum.

Gurtman, M. B. (1992). Construct validity of interpersonal personality measures: 
The interpersonal circumplex as a nomological net. *Journal of Personality and 
Social Psychology, 63*, 105-118.

Zimmermann, J., & Wright, A. G. C. (2017). Beyond description in interpersonal 
construct validation: Methodological advances in the circumplex Structural Summary 
Approach. *Assessment, 24*, 3-23.
